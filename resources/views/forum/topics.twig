<section class="panel panel-wrapper">
    <div class="panel-body">
        <div id="box-topics" class="box-forum">
            <ul id="sort" class="hidden-xs">
                <li>{{ sortable('last', 'Ostatni post', ['last', 'desc']) }}</li>
                <li>{{ sortable('id', 'Data utworzenia', ['last', 'desc']) }}</li>
                <li>{{ sortable('replies', 'Odpowiedzi', ['last', 'desc']) }}</li>
                <li>{{ sortable('views', 'Wyświetleń', ['last', 'desc']) }}</li>
                <li>{{ sortable('score', 'Głosów', ['last', 'desc']) }}</li>
                <li class="filter"><a href="javascript:">Filtruj</a></li>
            </ul>

            {% if forum is defined and not forum.is_locked %}
                <a href="{{ route('forum.topic.submit', [forum.path]) }}" class="btn btn-primary btn-sm pull-right">Nowy wątek</a>
            {% endif %}
            <div class="clearfix"></div>

            <table>
                {% set previous = null %}
                {% for topic in topics %}
                    {% set url = route('forum.topic', [topic.forum_path, topic.id, topic.path]) %}

                    {% if not topic.is_sticky and previous.is_sticky  %}
                        <tr>
                            <td colspan="4" class="sticky"></td>
                        </tr>
                    {% endif %}
                    <tr>
                        <td class="col-topic-icon">
                            {% set class = '' %}
                            {% set title = topic.unread ? 'Kliknij, aby oznaczyć jako przeczytane' %}

                            {% if topic.is_locked %}
                                {% set class = 'lock' %}
                            {% elseif topic.is_sticky %}
                                {% set class = 'sticky' %}
                            {% elseif topic.is_announcement %}
                                {% set class = 'announcement' %}
                            {% endif %}

                            <span title="{{ title }}" class="center-block ico {{ class }} {{ topic.unread ? 'new' : 'normal' }}"></span>
                        </td>
                        <td class="col-subject">
                            {% if topic.replies > 10 %}
                                {% set pages = (topic.replies / 10)|round(0, 'floor') + 1 %}
                                <dl class="topic-pagination hidden-xs">
                                    <dd>
                                        <a href="{{ url }}?page=1">1</a>

                                        {% if pages > 3 %}
                                            ...
                                        {% endif %}

                                        {% for i in max(2, pages - 3)..pages %}
                                            <a href="{{ url }}?page={{ i }}">{{ i }}</a>
                                        {% endfor %}
                                    </dd>
                                </dl>
                            {% endif %}

                            <a rel="nofollow" title="Przejdź do pierwszego nieczytanego postu" class="btn-view {{ topic.unread ? 'unread' }}" href="{{ url }}?view=unread"></a>

                            {% if topic.post_accept_id %}
                                <a rel="nofollow" title="Zobacz zaakceptowaną odpowiedź" class="btn-accepted" href="{{ url }}?p={{ topic.post_accept_id }}#id{{ topic.post_accept_id }}">
                                    <i class="fa fa-check"></i>
                                </a>
                            {% endif %}

                            <h5>
                                <a title="{{ topic.subject }}" href="{{ url }}">{{ topic.subject }}</a>
                            </h5>

                            {% if topic.tags %}
                                <ul class="tag-clouds pull-right hidden-sm hidden-xs">
                                    {% for tag in topic.tags %}
                                        <li><a href="{{ route('forum.tag', [tag.name]) }}">{{ tag.name }}</a></li>
                                    {% endfor %}
                                </ul>
                            {% endif %}

                            <strong>
                                <span class="timestamp" data-timestamp="{{ topic.first_created_at|timestamp }}" title="{{ topic.first_created_at|format_date }}">{{ topic.first_created_at|format_date }}</span>

                                {% if topic.author_id %}
                                    {{ link_to_profile(topic.author_id, topic.author_name, topic.author_is_active, topic.author_is_blocked) }}
                                {% else %}
                                    {{ topic.first_user_name }}
                                {% endif %}
                            </strong>
                        </td>
                        <td class="col-views hidden-xs">
                            <p title="Ilość odpowiedzi">
                                <strong>{{ topic.replies }}</strong>

                                {% if topic.replies != topic.replies_real and can('delete', forum) %}
                                    <small class="col-replies-real">({{ topic.replies - topic.replies_real }})</small>
                                {% endif %}
                                <small>{{ declination(topic.replies, ['odpowiedź', 'odpowiedzi', 'odpowiedzi'], true) }}</small>
                            </p>
                            <p title="Ilość wyświetleń"><strong>{{ topic.views }}</strong> <small>wyświetleń</small></p>
                        </td>
                        <td class="col-last-post hidden-xs">
                            {% if auth_check() %}
                                <a title="Obserwuj wątek" href="{{ route('forum.topic.subscribe', [topic.id]) }}" class="btn-watch-sm {{ topic.subscribe_on ? 'on' }}"></a>
                            {% endif %}

                            {% if topic.poster_id %}
                                <a href="{{ route('profile', [topic.poster_id]) }}" class="hidden-sm hidden-xs">
                                    <img class="img-thumbnail" src="{{ user_photo(topic.poster_photo) }}" width="35" height="35">
                                </a>
                            {% else %}
                                <img class="img-thumbnail" src="{{ asset('img/avatar.png') }}" width="35" height="35">
                            {% endif %}

                            <span class="timestamp" data-timestamp="{{ topic.last_created_at|timestamp }}" title="{{ topic.last_created_at|format_date(false) }}">{{ topic.last_created_at|format_date }}</span><br>

                            {% if topic.poster_id %}
                                {{ link_to_profile(topic.poster_id, topic.poster_name, topic.poster_is_active, topic.poster_is_blocked) }}
                            {% else %}
                                {{ topic.last_user_name }}
                            {% endif %}
                        </td>
                    </tr>

                    {% set previous = topic %}
                {% else %}
                    <tr>
                        <td colspan="4" style="text-align: center">Brak wątków do wyświetlenia.</td>
                    </tr>
                {% endfor %}

                <tr>
                    <td colspan="4" class="col-footer-nav">
                        <nav class="pull-left">
                            {{ topics.render()|raw }}
                        </nav>

                        {% if forumList is defined %}
                            <a class="btn pull-right" href="javascript:" id="btn-goto">
                                <i class="fa fa-arrow-circle-right"></i>
                            </a>

                            {{ form_select('forum', forumList, forum.path, {'class': 'pull-right', 'id': 'sel-forum-list'}) }}
                        {% endif %}
                    </td>
                </tr>
            </table>
        </div>

        {% if topics.count() > 10 and forum is defined and not forum.is_locked %}
            <a href="{{ route('forum.topic.submit', [forum.path]) }}" class="btn btn-primary btn-sm pull-right">Nowy wątek</a>
        {% endif %}
    </div>
</section>