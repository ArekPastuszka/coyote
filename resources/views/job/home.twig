{% extends 'job/base.twig' %}
{% block title %}Praca {{ parent() }}{% endblock %}

{% block container %}
    <div id="job-main-content" class="row">
        <main class="col-lg-9 col-md-12">

            <div class="row">
                <div id="box-filter" class="col-sm-3 hidden-xs">
                    <h5><i class="fa fa-cog fa-fw"></i> Technologie</h5>

                    {% if aggregations.tags %}
                        <ul class="list-group">
                            {% for tag, count in aggregations.tags %}
                                <li class="list-group-item">
                                    {{ form_checkbox('tag[]', tag, tag in selected.tags) }}

                                    <a href="{{ route('job.tag', [tag]) }}">
                                        {% if tag in selected.tags %}
                                            <i class="fa fa-check-square-o"></i>
                                        {% else %}
                                            <i class="fa fa-square-o"></i>
                                        {% endif %}

                                        <span>{{ tag }}</span>
                                        <small>({{ declination(count, ['oferta', 'oferty', 'ofert']) }})</small>
                                    </a>
                                </li>
                            {% endfor %}
                        </ul>
                    {% endif %}

                    {% if aggregations.cities %}
                        <h5><i class="fa fa-map-marker fa-fw"></i> Lokalizacja</h5>

                        <ul class="list-group">
                            {% for city, count in aggregations.cities %}
                                <li class="list-group-item">
                                    {{ form_checkbox('city[]', city, city in selected.cities) }}

                                    <a href="{{ route('job.city', [city|capitalize]) }}">
                                        {% if city in selected.cities %}
                                            <i class="fa fa-check-square-o"></i>
                                        {% else %}
                                            <i class="fa fa-square-o"></i>
                                        {% endif %}

                                        <span>{{ city|capitalize }}</span>
                                        <small>({{ declination(count, ['oferta', 'oferty', 'ofert']) }})</small>
                                    </a>
                                </li>
                            {% endfor %}
                        </ul>
                    {% endif %}
                </div>

                <div class="col-sm-9 col-xs-12">
                    <nav>
                        {{ pagination|raw }}
                    </nav>

                    <section class="panel panel-wrapper">
                        <div id="box-jobs" class="panel-body">
                            <ul id="sort" class="hidden-xs">
                                <li>{{ sortable('_score', 'Trafność', ['_score', 'desc']) }}</li>
                                <li>{{ sortable('id', 'Data dodania', ['_score', 'desc']) }}</li>
                                <li>{{ sortable('salary', 'Wynagrodzenie', ['_score', 'desc']) }}</li>
                            </ul>

                            <table>
                                <tbody>
                                    {% for job in jobs %}
                                        {% set url = route('job.offer', [job.id, job.path]) %}

                                        <tr>
                                            <td class="col-logo">
                                                {% if job.firm.logo %}
                                                    <a href="{{ url }}"><img title="{{ job.firm.name }}" src="{{ cdn('storage/logo/' ~ job.firm.logo) }}" width=""></a>
                                                {% else %}
                                                    <img src="{{ cdn('img/logo-gray.png') }}" width="">
                                                {% endif %}
                                            </td>
                                            <td class="col-body">
                                                <h2><a href="{{ url }}">{{ job.title }}</a></h2>

                                                <p>
                                                    {% if job.firm %}
                                                        <a class="employer" title="Zobacz oferty pracy z firmy {{ job.firm.name }}" href="{{ route('job.firm', [job.firm.name]) }}">{{ job.firm.name }}</a> &nbsp;•&nbsp;
                                                    {% endif %}

                                                    <small>{% include 'job.partials.location' with {'locations': job.locations.lists('city')} %}</small>

                                                    {% if job.is_remote %}
                                                        <small><a title="Praca zdalna jest możliwą opcją w przypadku tego ogłoszenia" href="{{ route('job.remote') }}">(praca zdalna)</a></small>
                                                    {% endif %}
                                                </p>

                                                {% if job.tags %}
                                                    <ul class="tag-clouds hidden-sm hidden-xs">
                                                        {% for tag in job.tags %}
                                                            <li><a data-category="job-tag" data-action="offer" data-value="{{ tag }}" title="Znajdź oferty z technologii: {{ tag }}" href="{{ route('job.tag', [tag]) }}">{{ tag }}</a></li>
                                                        {% endfor %}
                                                     </ul>
                                                {% endif %}
                                            </td>
                                            <td class="col-salary hidden-xs hidden-xxs">
                                                {% if job.salary_from or job.salary_to %}
                                                    <p class="text-primary">
                                                        {% include 'job.partials.salary' %}

                                                        {% if job.rate_id > 1 %}
                                                            <small>/ {{ ratesList[job.rate_id] }}</small>
                                                        {% endif %}
                                                    </p>
                                                {% endif %}
                                            </td>
                                            <td class="col-time hidden-sm hidden-xs hidden-xxs">
                                                {% if job.diff_in_days <= 1 %}
                                                    <p><span class="label label-new">Nowe</span></p>
                                                {% endif %}

                                                <small>{{ job.created_at|format_date }}</small>
                                            </td>
                                            <td class="col-fav">
                                                <a class="btn-fav" href="" title="Dodaj tę ofertę do ulubionych"></a>
                                            </td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </section>
                </div>
            </div>
        </main>

        <aside class="col-lg-3">

        </aside>
    </div>
{% endblock %}

{% block fixed %}
    <div id="job-header-container">
        <div class="row max-width">
            <div class="col-md-9">
                <div class="row">
                    <div class="col-xs-12">
                        <div class="row">
                            <div id="box-search" class="col-md-8 col-sm-12 col-xs-12">
                                {{ form_open({'url': route('job.home'), 'class': 'form-inline outline'}) }}
                                    <div class="form-group input-keywords col-sm-5 col-xs-5">
                                        <div class="col-content">
                                            {{ form_text('q', input_old('q'), {'class': 'form-control', 'placeholder': 'Słowo kluczowe lub nazwa firmy'}) }}
                                        </div>
                                    </div>

                                    <div class="form-group input-location col-sm-5 col-xs-5">
                                        <div class="col-content">
                                            {{ form_text('city', input_old('city'), {'class': 'form-control', 'placeholder': 'Nazwa miejscowości'}) }}
                                        </div>
                                    </div>

                                    <div class="form-group col-sm-2 col-xs-2">
                                        <button class="btn btn-primary btn-search" type="submit">
                                            <i class="fa fa-search"></i> <span class="hidden-xxs">1 800 ofert</span>
                                        </button>
                                    </div>

                                {{ form_close() }}
                            </div>
                        </div>
                    </div>
                </div>

                <ul class="nav nav-tabs">
                    <li role="presentation" class="active"><a href="{{ route('job.home') }}">Wszystkie</a></li>
                    <li role="presentation" title="Kliknij, aby zobaczyć oferty pasujące do mnie"><a href="{{ route('job.home') }}">Wybrane dla mnie</a></li>

                    {% if auth_check() %}
                        <li role="presentation" title="Kliknij, aby zobaczyć oferty dodane przeze mnie"><a href="{{ route('job.home') }}">Moje</a></li>
                    {% endif %}
                </ul>
            </div>

            <div class="col-md-3 hidden-sm hidden-xs">
                <section id="post-offer">
                    <h4>Dla pracodawców</h4>

                    <span class="outline">
                        <a href="{{ route('job.submit') }}" class="btn btn-primary" title="Dodaj ofertę pracy zupełnie za darmo!">Dodaj ofertę pracy</a>
                    </span>

                    <p>* żadnych ukrytych kosztów!</p>
                </section>
            </div>
        </div>
    </div>

    {{ parent() }}

    <div id="clients" class="hidden-sm hidden-xs">
        <div class="row max-width">
            <div class="col-xs-12">
                <h4>Z naszych usług korzystali...</h4>

                <div class="row">
                    <div class="col-sm-2 col-xs-4">
                        <img src="{{ cdn('img/logo/wp.png') }}" class="img-responsive">
                    </div>

                    <div class="col-sm-2 col-xs-4">
                        <img src="{{ cdn('img/logo/gazeta.png') }}" class="img-responsive">
                    </div>

                    <div class="col-sm-2 col-xs-4">
                        <img src="{{ cdn('img/logo/allegro.png') }}" class="img-responsive">
                    </div>

                    <div class="col-sm-2 col-xs-4">
                        <img src="{{ cdn('img/logo/nsn.png') }}" class="img-responsive" style="height: 25px">
                    </div>

                    <div class="col-sm-2 col-xs-4">
                        <img src="{{ cdn('img/logo/pgs-software.png') }}" class="img-responsive">
                    </div>

                    <div class="col-sm-2 col-xs-4">
                        <img src="{{ cdn('img/logo/microsoft.png') }}" class="img-responsive" style="height: 25px">
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}