{% extends 'job.base' %}
{% block title %}
    {{ job.title }}

    {% if job.firm_id and not firm.is_agency %}
        @ {{ firm.name }}
    {% endif %}

    {{ parent() }}
{% endblock %}

{% macro display_tags(tags) %}
    <ul class="tag-clouds">
        {% for tag in tags %}
            <li><a href="{{ route('job.tag', [tag.name]) }}" title="Znajdź oferty technologii {{ tag.name }}">{{ tag.name }}</a></li>
        {% endfor %}
    </ul>
{% endmacro %}

{% block container %}
    <div class="row" style="margin-top: 20px">
        <div class="col-md-9">
            <div class="panel panel-default">

                <div class="panel-body">
                    <div class="media">
                        {% if firm.logo %}
                            <div class="media-left">
                                <img class="media-object" src="{{ cdn('storage/logo/' ~ firm.logo) }}" style="width: 70px; height: 70px;" alt="{{ firm.name }}">
                            </div>
                        {% endif %}

                        <div id="job-offer" class="media-body">
                            <h1 class="media-heading">{{ link_to_route('job.offer', job.title, [job.id, job.path]) }}</h1>

                            {% if firm.name %}
                                <a class="employer" title="Zobacz oferty pracy z firmy {{ firm.name }}" href="{{ route('job.firm', [firm.name]) }}">{{ firm.name }}</a>
                            {% endif %}

                            {% if job.salary_from or job.salary_to %}
                                <strong class="salary pull-right text-primary">
                                    {% include 'job.partials.salary' with {'net_label': true, 'rate_label': true} %}
                                </strong>
                            {% endif %}

                            <ul class="metadata list-inline location">
                                <li title="Lokalizacja">
                                    <i class="fa fa-map-marker"></i>
                                    {{ job.country_name }}

                                    • {% include 'job.partials.location' with {'locations': job.locations.lists('city')} %}
                                </li>
                            </ul>

                            <ul class="metadata list-inline primary">
                                <li title="Data opublikowania">
                                    <i class="fa fa-calendar"></i>
                                    {{ job.created_at|format_date }}
                                </li>

                                {% if can('update', job) %}
                                    <li class="counter">
                                        <i class="fa fa-eye"></i>
                                        {{ declination(job.visits, ['odsłony', 'odsłon', 'odsłony']) }}
                                    </li>
                                {% endif %}

                                <li title="Oferta traci ważność z dniem {{ job.deadline_at|format_date(false) }}">
                                    <i class="fa fa-clock-o"></i>
                                    {{ deadline }} dni do końca
                                </li>
                                <li>
                                    <i class="fa fa-pencil"></i>
                                    {{ employmentList[job.employment_id] }}
                                </li>
                            </ul>

                            {% if tagsSet|length > 0 %}
                                <div class="tags">
                                    <div class="row">
                                        <div class="col-sm-6">
                                            <h5 class="must-have">Wymagane</h5>
                                        </div>

                                        {% if tagsSet[0] %}
                                            <div class="col-sm-6">
                                                <h5 class="nice-to-have">Mile widziane</h5>
                                            </div>
                                        {% endif %}
                                    </div>

                                    <div class="row">
                                        <div class="col-sm-6">
                                            {% if tagsSet[1] %}
                                                {{ _self.display_tags(tagsSet[1]) }}
                                            {% else %}
                                                --
                                            {% endif %}
                                        </div>

                                        <div class="col-sm-6">
                                            {{ _self.display_tags(tagsSet[0]) }}
                                        </div>
                                    </div>
                                </div>
                            {% endif %}

                            {% if job.description %}
                                <h2>Opis oferty</h2>

                                <div>
                                    {{ job.description|raw }}
                                </div>
                            {% endif %}

                            {% if firm.benefits|length %}
                                <h2>Oferujemy</h2>

                                <ul class="benefits list-group row">
                                    {% for benefit in firm.benefits %}
                                        <li class="list-group-item col-xs-6 checked"><i class="fa fa-check fa-fw"></i> {{ benefit.name }}</li>
                                    {% endfor %}
                                </ul>
                            {% endif %}

                            {% if firm.name and (firm.headline or firm.description) %}
                                <h2>{{ firm.name }}</h2>

                                <div>
                                    {% if firm.headline %}
                                        <blockquote>{{ firm.headline }}</blockquote>
                                    {% endif %}

                                    {{ firm.description|raw }}
                                </div>
                            {% endif %}

                            {% if not job.enable_apply %}
                                <h2>Informacje o rekrutacji</h2>

                                <div>
                                    {{ job.recruitment|raw }}
                                </div>
                            {% else %}
                                <div id="apply">
                                    <a class="btn btn-primary" href="#">Aplikuj na to stanowisko</a>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <aside class="col-md-3">
            <ul class="side-menu">
                <li>
                    <a class="btn-subscribe {{ subscribed ? 'on' }}" href="{{ route('job.subscribe', [job.id]) }}">
                        <i class="fa fa-fw fa-star-o"></i>
                        <i class="fa fa-fw fa-star"></i>

                        {{ not subscribed ? 'Dodaj do ulubionych' : 'Usuń z ulubionych' }}
                    </a>
                </li>
                {% if can('update', job) %}
                    <li>
                        <a class="btn-edit" href="{{ route('job.submit', [job.id]) }}">
                            <i class="fa fa-fw fa-edit"></i>
                            Edycja oferty
                        </a>
                    </li>
                {% endif %}
                <li>
                    <a class="btn-add" href="{{ route('job.submit') }}?revalidate=1"><i class="fa fa-fw fa-pencil"></i> Dodaj ofertę pracy</a>
                </li>
                <li>
                    <a class="btn-delete" href="javascript:"><i class="fa fa-fw fa-remove"></i> Usuń tę ofertę pracy</a>
                </li>
                <li>
                    <a class="btn-move" href="javascript:"><i class="fa fa-fw fa-arrow-circle-right"></i> Przenieś na forum</a>
                </li>
                <li>
                    <a class="btn-flag" href="javascript:"><i class="fa fa-fw fa-flag"></i> Zgłoś naruszenie</a>
                </li>
            </ul>

            {% if job.firm_id and (firm.street or firm.website or firm.employees or firm.founded or firm.latitude) %}
                <section id="box-job-firm" class="box">
                    <h4><i class="fa fa-info-circle fa-fw"></i> O firmie</h4>

                    <div class="panel panel-default">
                        <div class="panel-body">
                            <ul class="list-unstyled">
                                {% if firm.street %}
                                    <li>
                                        <i class="fa fa-home fa-fw"></i>
                                        {{ firm.street }} {{ firm.house }} {{ firm.postcode }} {{ firm.city }}
                                    </li>
                                {% endif %}
                                {% if firm.website %}
                                    <li>
                                        <i class="fa fa-link fa-fw"></i>
                                        <a href="{{ firm.website }}">{{ firm.website }}</a>
                                    </li>
                                {% endif %}
                                {% if firm.employees %}
                                    <li>
                                        <i class="fa fa-users fa-fw"></i>
                                        {{ employeesList[firm.employees] }} pracowników
                                    </li>
                                {% endif %}
                                {% if firm.founded %}
                                    <li>
                                        <i class="fa fa-calendar-o fa-fw"></i>
                                        Rok założenia: {{ firm.founded }}
                                    </li>
                                {% endif %}
                            </ul>

                            {% if firm.longitude and firm.latitude %}
                                <div id="map" style="height: 300px"></div>
                            {% endif %}
                        </div>
                    </div>
                </section>
            {% endif %}

            <section id="box-job-offers" class="box sidebar-job-offers">
                <h4><a href="#">Zobacz też</a></h4>

                <div class="panel panel-default">
                    <div class="panel-body">
                        <div class="media">
                            <div class="media-left">
                                <a href="#">
                                    <img class="media-object" src="/img/apple-touch.png" alt="Power Media S.A.">
                                </a>
                            </div>
                            <div class="media-body">
                                <h5 class="media-heading"><a href="#">Junior Web Developer</a></h5>

                                <p><a href="#" class="employer">Power Media S.A.</a></p>
                                <p class="bottom"><a href="#">Wrocław</a> • do 5000 zł</p>
                            </div>
                        </div>
                        <div class="media">
                            <div class="media-left">
                                <a href="#">
                                    <img class="media-object" src="/img/apple-touch.png" alt="Power Media S.A.">
                                </a>
                            </div>
                            <div class="media-body">
                                <h5 class="media-heading"><a href="#">Junior Web Developer</a></h5>

                                <p><a href="#" class="employer">Power Media S.A.</a></p>
                                <p class="bottom"><a href="#">Wrocław</a> • do 5000 zł</p>
                            </div>
                        </div>

                        <div class="media">
                            <a href="#" class="text-align">Więcej ofert w pobliżu Wrocław</a>
                        </div>
                    </div>
                </div>
            </section>

        </aside>
    </div>
{% endblock %}

{% block head %}
    {{ parent() }}

    <link rel="stylesheet" href="{{ cdn('css/job.css') }}">
{% endblock %}

{% block body %}
    {{ parent() }}

    <script src="//maps.googleapis.com/maps/api/js?key={{ config('services.google-maps.key') }}&sensor=false"></script>

    {% if firm.latitude and firm.longitude %}
        <script type="text/javascript">
            function initialize() {
                var coordinates = new google.maps.LatLng({{ firm.latitude }}, {{ firm.longitude }});
                var mapOptions = {
                    zoom: 16,
                    mapTypeId: google.maps.MapTypeId.ROADMAP,
                    center: coordinates
                };

                var map = new google.maps.Map(document.getElementById("map"), mapOptions);

                new google.maps.Marker({
                    map: map,
                    position: coordinates
                });
            }

            google.maps.event.addDomListener(window, 'load', initialize);
    </script>
    {% endif %}
{% endblock %}