{% extends 'adm.base' %}
{% block title %}Dziennik zdarzeń {{ parent() }}{% endblock %}

{% block container %}
    <div class="panel panel-default">
        <div class="panel-heading">Formularz wyszukiwania</div>
        <div class="panel-body">
            {{ form(form) }}
        </div>
    </div>

    {% if paginator.items() > 0 %}
        <div class="panel panel-default">
            <div class="panel-body">
                {{ paginator.render()|raw }}

                <div class="stream">
                    {% for activity in paginator %}
                        <div class="media">
                            <div class="media-left hidden-xs">
                                <a href="{{ activity.actor.url }}">
                                    <img class="media-object img-thumbnail" src="{{ user_photo(activity.actor.image) }}" style="width: 38px; height: 38px;" alt="">
                                </a>
                            </div>

                            <div class="media-body">
                                <p>{{ activity.headline|raw }}</p>

                                <ul class="list-inline">
                                    <li class="text-muted" title="{{ activity.created_at }}">
                                        {{ activity.created_at|format_date }}
                                    </li>

                                    <li class="text-muted" title="{{ activity.ip }}">
                                        <i class="fa fa-fw fa-laptop bubble" title="{{ activity.ip }}"></i>
                                        <a title="Kliknij, aby wyszukać" class="bubble" href="{{ route('adm.stream', {ip: activity.ip}) }}">{{ activity.ip }}</a>
                                    </li>

                                    {% if activity.browser %}
                                        <li class="text-muted" title="{{ activity.browser }}">
                                            <i class="fa fa-fw fa-globe bubble" title="{{ activity.browser }}"></i>

                                            <a title="Kliknij, aby wyszukać" class="bubble" href="{{ route('adm.stream', {browser: activity.browser}) }}">{{ activity.agent.browser }}, {{ activity.agent.platform }}</a>
                                        </li>
                                    {% endif %}

                                    {% if activity.fingerprint %}
                                        <li class="text-muted">
                                            <i class="fa fa-fw fa-info bubble" title="{{ activity.fingerprint[0] }}"></i>

                                            <a title="Kliknij, aby wyszukać" class="bubble" href="{{ route('adm.stream', {fingerprint: activity.fingerprint[0]}) }}">{{ activity.fingerprint[0][0:2] }} ... {{ activity.fingerprint[0][-2:2] }}</a>
                                        </li>
                                    {% endif %}
                                </ul>

                                {% if activity.excerpt %}
                                    <div class="well well-sm">{{ activity.excerpt }}</div>
                                {% endif %}
                            </div>
                        </div>
                    {% else %}
                        <span class="empty-result">Brak rekordów spełniających Twoje kryteria.</span>
                    {% endfor %}
                </div>

                {{ paginator.render()|raw }}
            </div>
        </div>
    {% endif %}
{% endblock %}

{% block body %}
    {{ parent() }}

    <script type="text/javascript" src="{{ cdn('js/auto-complete.js') }}"></script>
    <script type="text/javascript">
        $(function () {
            $('input[name="user_name"]').autocomplete({
                url: '{{ route('user.prompt') }}'
            });

            $('a[class~="bubble"],i[class~="bubble"]').tooltip();
        });
    </script>
{% endblock %}
