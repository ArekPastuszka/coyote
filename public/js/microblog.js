$(function(){"use strict";function t(t,e){var n=$(t).clone().html();for(var a in e)n=n.replace("[["+a+"]]",e[a]);return n}function e(e){var a=function(){$(this).parent().parent().remove()};return $("textarea",e).prompt(promptUrl).fastSubmit().autogrow().focus(),e.on("click",".btn-flush",a).submit(function(){var t=e.serialize();return $(":input",e).attr("disabled","disabled"),$.post(e.attr("action"),t,function(t){$(t).hide().insertAfter("nav.text-center").fadeIn(900),$("textarea",e).val("").trigger("keydown"),$(".thumbnails",e).html("")}).always(function(){$(":input",e).removeAttr("disabled")}),!1}).on("click",".btn-cancel",function(){var t=parseInt($(this).data("id"));return $("#entry-"+t).find(".microblog-text").html(i[t]),delete i[t],!1}).delegate("#btn-upload","click",function(){$(".input-file",e).click()}).delegate(".input-file","change",function(){var i=this.files[0];if("image/png"!==i.type&&"image/jpg"!==i.type&&"image/gif"!==i.type&&"image/jpeg"!==i.type)$("#alert").modal("show"),$(".modal-body").text("Format pliku jest nieprawidłowy. Załącznik musi być zdjęciem JPG, PNG lub GIF");else{var o=new FormData(e[0]);$.ajax({url:uploadUrl,type:"POST",data:o,cache:!1,contentType:!1,processData:!1,beforeSend:function(){$(".thumbnails",e).append(t("#tmpl-thumbnail",{src:n,"class":"spinner",fa:"fa fa-spinner fa-spin fa-2x"}))},success:function(t){var n=$(".thumbnail:last",e);$(".spinner",n).remove(),$("img",n).attr("src",t.url),$("<div>",{"class":"btn-flush"}).html('<i class="fa fa-remove fa-2x"></i>').click(a).appendTo(n),$('<input type="hidden" name="thumbnail[]" value="'+t.name+'">').appendTo(n)},error:function(t){$("#alert").modal("show"),"undefined"!=typeof t.responseJSON&&$(".modal-body").text(t.responseJSON.photo[0]),$(".thumbnail:last",e).remove()}},"json")}}),e}var n="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAfQAAADIAQMAAAAk14GrAAAABlBMVEXd3d3///+uIkqAAAAAI0lEQVRoge3BMQEAAADCoPVPbQ0PoAAAAAAAAAAAAAAAAHg2MgAAAYXziG4AAAAASUVORK5CYII=";$(document).ajaxError(function(t,e){$("#alert").modal("show");var n;n="undefined"!=typeof e.responseJSON.error?e.responseJSON.error:e.responseJSON.text,$(".modal-body").text(n)});var a,i={},o={},r={click:function(){var t=parseInt($(this).data("count")),e=$(this);return e.addClass("loader").text("Proszę czekać..."),$.post(e.attr("href"),function(n){t=parseInt(n.count),e.toggleClass("thumbs-on"),e.data("count",t)}).complete(function(){e.removeClass("loader"),e.text(t+" "+declination(t,["głos","głosy","głosów"]))}),!1},enter:function(){var t=parseInt($(this).data("count"));if(t>0){var e=$(this);"undefined"==typeof e.attr("title")&&(a=setTimeout(function(){$.get(e.attr("href"),function(t){if(e.attr("title",t),t.length){var n=t.split("\n").length;e.attr("title",t.replace(/\n/g,"<br />")).data("count",n).text(n+" "+declination(n,["głos","głosy","głosów"])).tooltip({html:!0}).tooltip("show")}})},500))}$(this).off("mouseenter")},leave:function(){clearTimeout(a)}};$("#microblog").on("click",".btn-reply",function(){$(this).parent().next(".microblog-comments").find("input").focus()}).on("click",".btn-watch",function(){var t=$(this);return $.post(t.attr("href"),function(){t.toggleClass("watch-on")}),!1}).on("click",".btn-thumbs, .btn-sm-thumbs",r.click).on("mouseenter",".btn-thumbs, .btn-sm-thumbs",r.enter).on("mouseleave",".btn-thumbs, .btn-sm-thumbs",r.leave).on("click",".btn-edit",function(t){var n=$(this),a=$("#entry-"+n.data("id")).find(".microblog-text");"undefined"==typeof i[n.data("id")]?$.get(n.attr("href"),function(t){i[n.data("id")]=a.html(),a.html(t);var o=e($(".microblog-submit",a));o.unbind("submit").submit(function(){var t=o.serialize();return $(":input",o).attr("disabled","disabled"),$.post(o.attr("action"),t,function(t){a.html(t),delete i[n.data("id")]}).always(function(){$(":input",o).removeAttr("disabled")}),!1})}):(a.html(i[n.data("id")]),delete i[n.data("id")]),t.preventDefault()}).on("click",".btn-remove",function(){var t=$(this);return $("#confirm").modal("show").one("click",".danger",function(){$.post(t.attr("href"),function(){$("#entry-"+t.data("id")).fadeOut(500)}),$("#confirm").modal("hide")}),!1}).on("focus",".comment-submit input",function(){"undefined"==typeof $(this).data("prompt")&&$(this).prompt(promptUrl).data("prompt","yes")}).on("submit",".comment-submit",function(){var t=$(this),e=$('input[type="text"]',t),n=t.serialize();return e.attr("disabled","disabled"),$.post(t.attr("action"),n,function(n){$(n).hide().insertBefore(t).fadeIn(800),e.val("")}).always(function(){e.removeAttr("disabled")}),!1}).on("click",".btn-sm-edit",function(t){var e=$(this),n=$("#comment-"+e.data("id")).find(".inline-edit"),a=function(){n.html(o[e.data("id")]),delete o[e.data("id")]};"undefined"==typeof o[e.data("id")]?$.get(e.attr("href"),function(t){o[e.data("id")]=n.html(),n.html("");var i=$("<form>"),r=$("<input>",{value:t,"class":"form-control",name:"text",autocomplete:"off"}).keydown(function(t){27===t.keyCode&&a()}).appendTo(i);i.submit(function(){var t=i.serialize();return r.attr("disabled","disabled"),$.post(e.attr("href"),t,function(t){$("#comment-"+e.data("id")).replaceWith(t),delete o[e.data("id")]}).always(function(){r.removeAttr("disabled")}),!1}),i.appendTo(n),r.focus().prompt(promptUrl)}):a(),t.preventDefault()}).on("click",".btn-sm-remove",function(){var t=$(this);return $("#confirm").modal("show").one("click",".danger",function(){$.post(t.attr("href"),function(){$("#comment-"+t.data("id")).fadeOut(500)}),$("#confirm").modal("hide")}),!1}).on("click",".show-all a",function(){var t=$(this);return t.text("Proszę czekać..."),$.get(t.attr("href"),function(e){t.parent().replaceWith(e)}),!1}),e($(".microblog-submit"))});
//# sourceMappingURL=microblog.js.map