$(function(){"use strict";function t(t,e){var n=$(t).clone().html();for(var i in e)n=n.replace("[["+i+"]]",e[i]);return n}function e(e){var i=function(){$(this).parent().parent().remove()};return e.on("click",".btn-flush",i).submit(function(){return $.post(e.attr("action"),e.serialize(),function(t){$(t).hide().insertAfter("nav.text-center").fadeIn(900)}),!1}).on("click",".btn-cancel",function(){var t=parseInt($(this).data("id"));return $("#entry-"+t).find(".microblog-text").html(a[t]),delete a[t],!1}).delegate("#btn-upload","click",function(){$(".input-file",e).click()}).delegate(".input-file","change",function(){var a=this.files[0];if("image/png"!==a.type&&"image/jpg"!==a.type&&"image/gif"!==a.type&&"image/jpeg"!==a.type)$("#alert").modal("show"),$(".modal-body").text("Format pliku jest nieprawidłowy. Załącznik musi być zdjęciem JPG, PNG lub GIF");else{var o=new FormData(e[0]);$.ajax({url:uploadUrl,type:"POST",data:o,cache:!1,contentType:!1,processData:!1,beforeSend:function(){$(".thumbnails",e).append(t("#tmpl-thumbnail",{src:n,"class":"spinner",fa:"fa fa-spinner fa-spin fa-2x"}))},success:function(t){var n=$(".thumbnail:last",e);$(".spinner",n).remove(),$("img",n).attr("src",t.url),$("<div>",{"class":"btn-flush"}).html('<i class="fa fa-remove fa-2x"></i>').click(i).appendTo(n),$('<input type="hidden" name="thumbnail[]" value="'+t.name+'">').appendTo(n)},error:function(t){$("#alert").modal("show"),"undefined"!=typeof t.responseJSON&&$(".modal-body").text(t.responseJSON.photo[0]),$(".thumbnail:last",e).remove()}},"json")}}),e}var n="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAfQAAADIAQMAAAAk14GrAAAABlBMVEXd3d3///+uIkqAAAAAI0lEQVRoge3BMQEAAADCoPVPbQ0PoAAAAAAAAAAAAAAAAHg2MgAAAYXziG4AAAAASUVORK5CYII=";$(document).ajaxError(function(t,e){$("#alert").modal("show"),$(".modal-body").text(e.responseJSON.error)});var i,a={},o={},r={click:function(){var t=parseInt($(this).data("count")),e=$(this);return e.addClass("loader").text("Proszę czekać..."),$.post(e.attr("href"),function(n){t=parseInt(n.count),e.toggleClass("thumbs-on"),e.data("count",t)}).complete(function(){e.removeClass("loader"),e.text(t+" "+declination(t,["głos","głosy","głosów"]))}),!1},enter:function(){var t=parseInt($(this).data("count"));if(t>0){var e=$(this);"undefined"==typeof e.attr("title")&&(i=setTimeout(function(){$.get(e.attr("href"),function(t){if(e.attr("title",t),t.length){var n=t.split("\n").length;e.attr("title",t.replace(/\n/g,"<br />")).data("count",n).text(n+" "+declination(n,["głos","głosy","głosów"])).tooltip({html:!0}).tooltip("show")}})},500))}$(this).off("mouseenter")},leave:function(){clearTimeout(i),$(".tooltip").remove()}};$("#microblog").on("click",".btn-reply",function(){$(this).parent().next(".microblog-comments").find("input").focus()}).on("click",".btn-watch",function(){var t=$(this);return $.post(t.attr("href"),function(){t.toggleClass("watch-on")}),!1}).on("click",".btn-thumbs, .btn-sm-thumbs",r.click).on("mouseenter",".btn-thumbs, .btn-sm-thumbs",r.enter).on("mouseleave",".btn-thumbs, .btn-sm-thumbs",r.leave).on("click",".btn-edit",function(t){var n=$(this);$.get(n.attr("href"),function(t){var i=$("#entry-"+n.data("id")).find(".microblog-text");a[n.data("id")]=i.html(),i.html(t);var o=e($(".microblog-submit",i));o.unbind("submit").submit(function(){return $.post(o.attr("action"),o.serialize(),function(t){i.html(t),delete a[n.data("id")]}),!1})}),t.preventDefault()}).on("click",".btn-remove",function(){var t=$(this);return $.post(t.attr("href"),function(){$("#entry-"+t.data("id")).fadeOut(500)}),!1}).on("submit",".comment-submit",function(){var t=$(this),e=$('input[type="text"]',t),n=t.serialize();return e.attr("disabled","disabled"),$.post(t.attr("action"),n,function(n){$(n).hide().insertBefore(t).fadeIn(800),e.val("")}).always(function(){e.removeAttr("disabled")}),!1}).on("click",".btn-sm-edit",function(t){var e=$(this),n=$("#comment-"+e.data("id")).find(".inline-edit");$.get(e.attr("href"),function(t){o[e.data("id")]=n.html(),n.html("");var i=$("<form>"),a=$("<input>",{value:t,"class":"form-control",name:"text"}).keydown(function(t){27===t.keyCode&&(n.html(o[e.data("id")]),delete o[e.data("id")])}).appendTo(i);i.submit(function(){var t=i.serialize();return a.attr("disabled","disabled"),$.post(e.attr("href"),t,function(t){$("#comment-"+e.data("id")).replaceWith(t)}),!1}),i.appendTo(n)}),t.preventDefault()}).on("click",".btn-sm-remove",function(){var t=$(this);return $.post(t.attr("href"),function(){$("#comment-"+t.data("id")).fadeOut(500)}),!1}),e($(".microblog-submit"))}),function(t){t.fn.prompt=function(e){return this.each(function(){var n=t(this),i=-1,a=0,o=t('<ul style="display: none;" class="auto-complete"></ul>'),r=function(){if(n[0].selectionStart||0==n[0].selectionStart)return n[0].selectionStart;if(document.selection){n.focus();var t=document.selection.createRange();return t.moveStart("character",-n.value.length),t.text.length}},s=function(t){for(var e=t,i=-1;e>t-50&&e>=0;){var a=n.val()[e];if(" "===a)break;if("@"===a&&(0===e||" "===n.val()[e-1]||"\n"===n.val()[e-1])){i=e+1;break}e--}return i},c=function(e){var n=t("li",o).length;n>0&&(e>=n?e=0:0>e&&(e=n-1),i=e,t("li",o).removeClass("hover"),t("li:eq("+i+")",o).addClass("hover"))};n.bind("keyup click",function(l){var u="",f=l.keyCode,d=r(),h=s(d);h>-1&&(u=n.val().substr(h,d-h));var m=function(){var e=t("li.hover span",o).text();if(e.length){(e.indexOf(" ")>-1||e.indexOf(".")>-1)&&(e="{"+e+"}"),n.val(n.val().substr(0,h)+e+n.val().substring(d)).trigger("change").focus();var i=h+e.length;if(n[0].setSelectionRange)n[0].setSelectionRange(i,i);else if(n[0].createTextRange){var a=n[0].createTextRange();a.collapse(!0),a.moveEnd("character",i),a.moveStart("character",i),a.select()}}o.html("").hide()};switch(f){case 27:o.html("").hide();break;case 40:c(i+1);break;case 38:c(i-1);break;case 13:m();break;default:u.length>=2?(clearTimeout(a),a=setTimeout(function(){t.get(e,{q:u},function(e){o.html(e).hide();var a=t("li",o).length;if(a>0){var r=n.offset();t("li",o).click(m).hover(function(){t("li",o).removeClass("hover"),t(this).addClass("hover")},function(){t(this).removeClass("hover")}),o.css({width:n.outerWidth(),top:n.outerHeight()+r.top+1,left:r.left}).show(),i=-1}})},200)):o.html("").hide()}}).keydown(function(t){var e=t.keyCode;return 40!==e&&38!==e&&13!==e&&27!==e||!o.is(":visible")?void 0:(t.preventDefault(),!1)}),o.appendTo(document.body),t(document).bind("click",function(e){var n=t(e.target);n.not(o)&&o.html("").hide()})})}}(jQuery),function(t){"use strict";t.fn.autogrow=function(){return this.each(function(){var e=t(this),n=e.height(),i=300,a=(e.css("lineHeight"),0),o=0,r=t("<div></div>").css({position:"absolute",top:-1e4,left:-1e4,width:t(this).width()-parseInt(e.css("paddingLeft"))-parseInt(e.css("paddingRight")),fontSize:e.css("fontSize"),fontFamily:e.css("fontFamily"),lineHeight:e.css("lineHeight"),resize:"none"}).appendTo(document.body),s=function(){var e=function(t,e){for(var n=0,i="";e>n;n++)i+=t;return i},a=this.value.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/&/g,"&amp;").replace(/\n$/,"<br/>&nbsp;").replace(/\n/g,"<br/>").replace(/ {2,}/g,function(t){return e("&nbsp;",t.length-1)+" "});r.html(a),t(this).css("height",Math.max(Math.min(r.height()+17,i),n))};e.change(s).keyup(s).keydown(s),s.apply(this),e.mousedown(function(){a=e.width(),o=e.height()}).mouseup(function(){(e.width()!=a||e.height()!=o)&&e.unbind("keyup",s).unbind("keydown",s).unbind("change",s),a=o=0})})}}(jQuery),function(t){"use strict";t.fn.fastSubmit=function(){return this.each(function(){t(this).keydown(function(e){if(13===e.keyCode){var n=t(this).closest("form");e.ctrlKey&&n.submit()}})})}}(jQuery);
//# sourceMappingURL=microblog.js.map