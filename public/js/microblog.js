$(function(){"use strict";function e(e,t){var n=$(e).clone().html();for(var i in t)n=n.replace("[["+i+"]]",t[i]);return n}function t(t){var n=function(){$(this).parent().remove()};t.submit(function(){}).delegate("#btn-upload","click",function(){$(".input-file",t).click()}).delegate(".input-file","change",function(){var o=this.files[0];if("image/png"!==o.type&&"image/jpg"!==o.type&&"image/gif"!==o.type&&"image/jpeg"!==o.type)$("#alert").modal("show"),$(".modal-body").text("Format pliku jest nieprawidłowy. Załącznik musi być zdjęciem JPG, PNG lub GIF");else{var a=new FormData(t[0]);$.ajax({url:uploadUrl,type:"POST",data:a,cache:!1,contentType:!1,processData:!1,beforeSend:function(){$(".thumbnails").append(e("#tmpl-thumbnail",{src:i,"class":"spinner",fa:"fa fa-spinner fa-spin fa-2x"}))},success:function(e){var t=$(".thumbnail:last");$(".spinner",t).remove(),$("img",t).attr("src",e.url),$("<div>",{"class":"btn-delete"}).html('<i class="fa fa-remove fa-2x"></i>').click(n).appendTo(t)},error:function(e){$("#alert").modal("show"),"undefined"!=typeof e.responseJSON&&$(".modal-body").text(e.responseJSON.photo[0]),$(".thumbnail:last").remove()}},"json")}})}var n,i="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAfQAAADIAQMAAAAk14GrAAAABlBMVEXd3d3///+uIkqAAAAAI0lEQVRoge3BMQEAAADCoPVPbQ0PoAAAAAAAAAAAAAAAAHg2MgAAAYXziG4AAAAASUVORK5CYII=",o={click:function(){var e=parseInt($(this).data("count")),t=$(this);t.addClass("loader").text("Proszę czekać..."),$.post(voteUrl+t.data("id"),function(n){e=parseInt(n.count),t.toggleClass("thumbs-on"),t.data("count",e)}).complete(function(){t.removeClass("loader"),t.text(e+" "+declination(e,["głos","głosy","głosów"]))}).fail(function(e){$("#alert").modal("show"),$(".modal-body").text(e.responseJSON.error)})},enter:function(){var e=parseInt($(this).data("count"));if(e>0){var t=$(this);"undefined"==typeof t.attr("title")&&(n=setTimeout(function(){$.get(voteUrl+t.data("id"),function(e){if(t.attr("title",e),e.length){var n=e.split("\n").length;t.attr("title",e.replace(/\n/g,"<br />")).data("count",n).text(n+" "+declination(n,["głos","głosy","głosów"])).tooltip({html:!0}).tooltip("show")}})},500))}$(this).off("mouseenter")},leave:function(){clearTimeout(n),$(".tooltip").remove()}};$("#microblog").on("click",".btn-reply",function(){$(this).parent().next(".microblog-comments").find("input").focus()}).on("click",".btn-thumbs",o.click).on("mouseenter",".btn-thumbs",o.enter).on("mouseleave",".btn-thumbs",o.leave),t($(".microblog-submit"))}),function(e){e.fn.prompt=function(t){return this.each(function(){var n=e(this),i=-1,o=0,a=e('<ul style="display: none;" class="auto-complete"></ul>'),r=function(){if(n[0].selectionStart||0==n[0].selectionStart)return n[0].selectionStart;if(document.selection){n.focus();var e=document.selection.createRange();return e.moveStart("character",-n.value.length),e.text.length}},s=function(e){for(var t=e,i=-1;t>e-50&&t>=0;){var o=n.val()[t];if(" "===o)break;if("@"===o&&(0===t||" "===n.val()[t-1]||"\n"===n.val()[t-1])){i=t+1;break}t--}return i},c=function(t){var n=e("li",a).length;n>0&&(t>=n?t=0:0>t&&(t=n-1),i=t,e("li",a).removeClass("hover"),e("li:eq("+i+")",a).addClass("hover"))};n.bind("keyup click",function(l){var u="",f=l.keyCode,h=r(),d=s(h);d>-1&&(u=n.val().substr(d,h-d));var p=function(){var t=e("li.hover span",a).text();if(t.length){(t.indexOf(" ")>-1||t.indexOf(".")>-1)&&(t="{"+t+"}"),n.val(n.val().substr(0,d)+t+n.val().substring(h)).trigger("change").focus();var i=d+t.length;if(n[0].setSelectionRange)n[0].setSelectionRange(i,i);else if(n[0].createTextRange){var o=n[0].createTextRange();o.collapse(!0),o.moveEnd("character",i),o.moveStart("character",i),o.select()}}a.html("").hide()};switch(f){case 27:a.html("").hide();break;case 40:c(i+1);break;case 38:c(i-1);break;case 13:p();break;default:u.length>=2?(clearTimeout(o),o=setTimeout(function(){e.get(t,{q:u},function(t){a.html(t).hide();var o=e("li",a).length;if(o>0){var r=n.offset();e("li",a).click(p).hover(function(){e("li",a).removeClass("hover"),e(this).addClass("hover")},function(){e(this).removeClass("hover")}),a.css({width:n.outerWidth(),top:n.outerHeight()+r.top+1,left:r.left}).show(),i=-1}})},200)):a.html("").hide()}}).keydown(function(e){var t=e.keyCode;return 40!==t&&38!==t&&13!==t&&27!==t||!a.is(":visible")?void 0:(e.preventDefault(),!1)}),a.appendTo(document.body),e(document).bind("click",function(t){var n=e(t.target);n.not(a)&&a.html("").hide()})})}}(jQuery),function(e){"use strict";e.fn.autogrow=function(){return this.each(function(){var t=e(this),n=t.height(),i=300,o=(t.css("lineHeight"),0),a=0,r=e("<div></div>").css({position:"absolute",top:-1e4,left:-1e4,width:e(this).width()-parseInt(t.css("paddingLeft"))-parseInt(t.css("paddingRight")),fontSize:t.css("fontSize"),fontFamily:t.css("fontFamily"),lineHeight:t.css("lineHeight"),resize:"none"}).appendTo(document.body),s=function(){var t=function(e,t){for(var n=0,i="";t>n;n++)i+=e;return i},o=this.value.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/&/g,"&amp;").replace(/\n$/,"<br/>&nbsp;").replace(/\n/g,"<br/>").replace(/ {2,}/g,function(e){return t("&nbsp;",e.length-1)+" "});r.html(o),e(this).css("height",Math.max(Math.min(r.height()+17,i),n))};t.change(s).keyup(s).keydown(s),s.apply(this),t.mousedown(function(){o=t.width(),a=t.height()}).mouseup(function(){(t.width()!=o||t.height()!=a)&&t.unbind("keyup",s).unbind("keydown",s).unbind("change",s),o=a=0})})}}(jQuery),function(e){"use strict";e.fn.fastSubmit=function(){return this.each(function(){e(this).keydown(function(t){if(13===t.keyCode){var n=e(this).closest("form");t.ctrlKey&&n.submit()}})})}}(jQuery);
//# sourceMappingURL=microblog.js.map